---
title: "Quick start guide"
author: "Martin Westgate"
date: '2024-01-18'
output:
  rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Quick start guide}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo=FALSE}
library(galaxias)
```

`galaxias` is an R package to help users build repositories that are optimised
for storing, documenting and sharing biodiversity data. These repositories can 
be seamlessly converted into a **Darwin Core Archive**, the data standard used 
by the [Global Biodiversity Information Facility (GBIF)](https://gbif.org) and
it's partner nodes.


## Start a new project

To start a new data project in RStudio, simply click:

`File` > `New Project` > `New Directory` > `Biodiversity Data Project using galaxias` 

(Note: if this is your first time installing `galaxias`, you will need to close 
and reopen RStudio for this menu item to appear)

Alternatively, you can use the following function in the console:
```{r, eval=FALSE}
library(galaxias)
create_bd_project("myprojectname")
```

If you are using RStudio, both options should launch a new RStudio instance for
that project, containing the following files:

  * `.Rproj` file 
  * `README.md` to supply metadata statement about your project
  * `data-raw` folder to store raw data, containing a boilerplate `.R` file
  * an empty `data` folder to place 'processed' data

It is a good idea to write some basic information in your `README.Rmd` file
first, as this provides guidance to your users as to what your package contains,
as well as what they are allowed to use it for.


## Adding data to your project

We recommend that you first add your data to the `data-raw` folder, then use a 
script within that folder to manipulate it to a suitable interchange format 
(such as Darwin Core). Let's assume, for example, that your data is looks like 
this:

```{r, eval=FALSE}
library(dplyr)

df <- tibble(
  latitude = c(-35.310, -35.273),
  longitude = c(149.125, 149.133),
  date = c("14-01-2023", "15-01-2023"),
  time = c("10:23", "11:25"),
  species = c("Callocephalon fimbriatum", "Eolophus roseicapilla"),
  n = c(2, 3))
```

(Note that normally you'd import your data from an external file (e.g. using
`readr::read_csv()`), but we've constructed one here for example purposes.)

Next, there are a few steps you could follow:

```{r, eval=FALSE}
library(glue)

df <- df |>
  # Rename columns to Darwin Core names
  rename(decimalLatitude = latitude,
         decimalLongitude = longitude,
         scientificName = species,
         individualCount = n) |>
  # Amend date column to standard format
  mutate(date = dmy(date)) |>
  # Add previously missing information supported or required by Darwin Core
  mutate(occurrenceID = seq_len(nrow(df)),
         eventDate = glue("{date}T{time}:00Z"),
         taxonRank = "species",
         basisOfRecord = "humanObservation", # replace with `use_basisOfRecord()`
         recordedBy = "Martin Westgate") |>
  # Place columns in a sensible order
  select(occurrenceID, eventDate, decimalLatitude, decimalLongitude,
         scientificName, taxonRank, individualCount, recordedBy,
         basisOfRecord)
```

From there, it is simple to save your files out to `/data` as `csv`:

```{r, eval=FALSE}
library(readr)
write_csv(df, "./data/occurrences.csv")
```

If your data are _already_ in Darwin Core format, you can simply place them 
in the data folder and remove your `data-raw` folder.


## Adding package metadata

Darwin Core Archives use `xml` files to store metadata, but this format is 
tricky to work with for data entry. Therefore, we suggest that you store your 
metadata as a markdown file. You can generate a file called `metadata.md` 
in your project directory by calling:

```{r, eval=FALSE}
use_bd_metadata()
```

Storing metadata in markdown files has several advantages over xml:

- **clarity:** markdown is easy to read and edit
- **persistence:** markdown files live in your file structure rather than your R environment, so
  are easy to store, share and update
- **visualisation:** it is straightforward to render the file as a PDF or HTML for viewing or sharing


## Check your respository

Darwin Core may be an unfamiliar format, so it can be useful to 'check' your
data for common issues. `galaxias` supports three methods for delivering this,
the easiest of which is to use the features built into `README.Rmd` to check your 
data (INCOMPLETE)

Second is to use `pointblank` somehow

Finally, you can use the ALA 'validate' API to check your data (not functional!)

```{r, eval=FALSE}
validate_dwca()
```

## Sharing your data

build_dwca() # convert to a DwCA

This does the following steps:

  * looks for data and builds a schema using `use_bd_schema()`
  * converts `schema.md` and `metadata.md` to `xml`
  * zips data and metadata into a DwCA

`publish_dwca()` can take a pre-built archive if you have already run 
`build_dwca()`, or can build one for you in a temporary directory and send that.